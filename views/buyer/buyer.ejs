<!DOCTYPE html>
<html class="no-js" lang="en">


<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>حساب کاربری من - کینگ کارپت</title>
    <meta name="robots" content="noindex, follow" />
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="assets/images/favicon.png">

    <!-- CSS
	============================================ -->

    <!-- Vendor CSS (Bootstrap & Icon Font) -->
    <!-- <link rel="stylesheet" href="assets/css/vendor/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/vendor/font-awesome-pro.min.css">
    <link rel="stylesheet" href="assets/css/vendor/font-gilroy.css"> -->

    <!-- Plugins CSS (All Plugins Files) -->
    <!-- <link rel="stylesheet" href="assets/css/plugins/select2.min.css">
    <link rel="stylesheet" href="assets/css/plugins/perfect-scrollbar.css">
    <link rel="stylesheet" href="assets/css/plugins/swiper.min.css">
    <link rel="stylesheet" href="assets/css/plugins/nice-select.css">
    <link rel="stylesheet" href="assets/css/plugins/ion.rangeSlider.min.css">
    <link rel="stylesheet" href="assets/css/plugins/photoswipe.css">
    <link rel="stylesheet" href="assets/css/plugins/photoswipe-default-skin.css">
    <link rel="stylesheet" href="assets/css/plugins/magnific-popup.css">
    <link rel="stylesheet" href="assets/css/plugins/slick.css"> -->

    <!-- Main Style CSS -->
    <!-- <link rel="stylesheet" href="assets/css/style.css"> -->

    <!-- Use the minified version files listed below for better performance and remove the files listed above -->
    <link rel="stylesheet" href="assets/css/vendor/vendor.min.css">
    <link rel="stylesheet" href="assets/css/plugins/plugins.min.css">
    <link rel="stylesheet" href="assets/css/style.min.css">

</head>

<body>

    <div id="page">
        <!-- Header Section Start -->
        <%- include('./../header' , {req , Sbrand :'' , category:'' , card}) %>

        <!-- Header Section End -->

        <!-- Page Title Section Start -->
        <div class="page-title-section section">
            <div class="page-title">
                <div class="container">
                    <h1 class="title">حساب کاربری من</h1>
                </div>
            </div>
            <div class="page-breadcrumb">
                <div class="container">
                    <ul class="breadcrumb">
                        <li><a href="/">صفحه اصلی</a></li>
                        <li class="current">حساب کاربری من</li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- Page Title Section End -->


        <!--My Account section start-->
        <div class="my-account-section section section-padding-bottom">
            <div class="container">
                <div class="row">

                    <div class="col-12">
                        <div class="row">
                            <!-- My Account Tab Menu Start -->
                            <div class="col-lg-3 col-12">
                                <div class="myaccount-tab-menu nav" role="tablist">
                                    <a href="#dashboad" class="active" data-toggle="tab"><i class="far fa-tachometer-alt-slow"></i>
                                        داشبورد</a>

                                    <a href="#orders" data-toggle="tab"><i class="fa fa-cart-arrow-down"></i> سفارشات باز</a>

                                    <!-- <a href="#download" data-toggle="tab"><i class="fa fa-cloud-download"></i> دانلود ها</a> -->

                                    <a href="#payment-method" data-toggle="tab"><i class="fa fa-credit-card"></i>  تاریخچه پرداخت ها و سفارشات</a>

                                    <a href="#address-edit" data-toggle="tab"><i class="fa fa-map-marker"></i> آدرس ها</a>

                                    <a href="#account-info" data-toggle="tab"><i class="fa fa-user"></i> جزئیات حساب</a>

                                    <a href="/logout"><i class="fa fa-sign-out"></i> خروج</a>
                                </div>
                            </div>
                            <!-- My Account Tab Menu End -->

                            <!-- My Account Tab Content Start -->
                            <div class="col-lg-9 col-12">
                                <div class="tab-content" id="myaccountContent">
                                    <!-- Single Tab Content Start -->
                                    <div class="tab-pane fade show active" id="dashboad" role="tabpanel">
                                        <div class="myaccount-content">
                                            <h3>داشبورد</h3>

                                            <div class="welcome mb-20">
                                                <p>سلا, <strong><%- buyer.fullName %></strong> (شما آقای/خانم <strong><%- buyer.fullName %> نیستید؟ !</strong><a href="/logout" class="logout"> خروج از سیستم</a>)</p>
                                            </div>

                                            <p class="mb-0">از داشبورد حساب خود به راحتی می توانید سفارشات اخیر خود را بررسی و مشاهده کنید ، آدرس حمل و نقل و صورتحساب خود را مدیریت کرده و رمزعبور و جزئیات حساب خود را ویرایش کنید.</p>
                                        </div>
                                    </div>
                                    <!-- Single Tab Content End -->

                                    <!-- Single Tab Content Start -->
                                    <div class="tab-pane fade" id="orders" role="tabpanel">
                                        <div class="myaccount-content">
                                            <h3>سفارشات</h3>


                                            <div class="myaccount-table table-responsive text-center">

                                                <% if(order.length == 0) { %>
                                                    <h5>شما هیچ سفارشی تا بدین لحضه ندارید</h5>
                                                <% } else { %>
                                                <table class="table table-bordered">
                                                    <thead class="thead-light">
                                                        <tr>
                                                            <th>تصویر</th>
                                                            <th>نام محصول</th>
                                                            <th>تعداد صفارش</th>
                                                            <th>قیمت هر یک</th>
                                                            <th>جمع قیمت</th>
                                                            <th>عملیات</th>
                                                        </tr>
                                                    </thead>

                                                    <tbody> 
                                                        <% order.forEach(order => { %>
                                                        <tr>
                                                            <% if(order.product) { %> 
                                                            <td><img src="<%- order.product.thump %>" alt=""></td>
                                                            <% }else { %>
                                                            <td>محصول موردنظر پیدا نشد(احتمالا حذف شده است)</td>
                                                            <% } %>

                                                            <% if(order.product) { %> 
                                                            <td><%- order.product.title %></td>
                                                            <% }else{ %>
                                                            <td>محصول موردنظر پیدا نشد(احتمالا حذف شده است)</td>
                                                            <% } %>

                                                            <td><%- order.count %></td>
                                                            <% if(order.product) { %> 
                                                            <td><%- price(order.product.price) %></td>
                                                            <% }else{ %>
                                                            <td>محصول موردنظر پیدا نشد(احتمالا حذف شده است)</td>
                                                            <% } %>
                                                            
                                                            <td><%- price(order.price) %></td>
                                                            <td><%- date(order.createdAt).format('jD jMMMM jYYYY') %></td>
                                                            <td><a href="/buyer/orderInvoice/<%- order.id %>" class="ht-btn black-btn" style="color:orange">نمایش فاکتور و صورت حساب</a></td>
                                                        </tr>
                                                        <% }) %>
                                                    </tbody>
                                                </table>
                                                <% } %>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Single Tab Content End -->

                                    <!-- Single Tab Content Start -->
                                    <!-- <div class="tab-pane fade" id="download" role="tabpanel">
                                        <div class="myaccount-content">
                                            <h3>دانلود ها</h3>

                                            <div class="myaccount-table table-responsive text-center">
                                                <table class="table table-bordered">
                                                    <thead class="thead-light">
                                                        <tr>
                                                            <th>محصول</th>
                                                            <th>تاریخ</th>
                                                            <th>منقضی</th>
                                                            <th>دانلود</th>
                                                        </tr>
                                                    </thead>

                                                    <tbody>
                                                        <tr>
                                                            <td>روغن مخلوط کردن</td>
                                                            <td>دی 1399</td>
                                                            <td>بله</td>
                                                            <td><a href="#" class="ht-btn black-btn">دانلود فایل</a></td>
                                                        </tr>
                                                        <tr>
                                                            <td>سعید خان</td>
                                                            <td>دی 1399</td>
                                                            <td>هرگز</td>
                                                            <td><a href="#" class="ht-btn black-btn">دانلود فایل</a></td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div> -->
                                    <!-- Single Tab Content End -->

                                    <!-- Single Tab Content Start -->
                                    <div class="tab-pane fade" id="payment-method" role="tabpanel">
                                        <div class="myaccount-content">
                                            <h3>تاریخچه</h3>

                                            <div class="myaccount-table table-responsive text-center">

                                                <% if(history.length == 0) { %>
                                                    <h5>شما هیچ سفارشی تا بدین لحضه ندارید</h5>
                                                <% } else { %>
                                                <table class="table table-bordered">
                                                    <thead class="thead-light">
                                                        <tr>
                                                            <th>تصویر</th>
                                                            <th>نام محصول</th>
                                                            <th>تعداد صفارش</th>
                                                            <th>کد پیگیری</th>
                                                            <th>قیمت جمع</th>
                                                            <th>تاریخ</th>
                                                            <th>نتیجه عملیات</th>
                                                        </tr>
                                                    </thead>

                                                    <tbody> 
                                                        <% history.forEach(history => { %>
                                                        <tr>
                                                            <% if(history.product) { %> 
                                                            <td><img src="<%- history.product.thump %>" alt=""></td>
                                                            <% } else { %>
                                                                <td>محصول یافت نشد</td>
                                                            <% } %>
                                                            <td><%- history.title %></td>
                                                            <td><%- history.count %></td>
                                                            <td><%- history.code %></td>
                                                            <td><%- price(history.price)  %></td>
                                                            <td><%- date(history.createdAt).format('jD jMMMM jYYYY') %></td>
                                                            <% if(history.status) { %>
                                                            <td style="background-color: green; color:black">موفق</td>
                                                            <% } else { %>
                                                            <td style="background-color: red; color:black">نا موفق</td>
                                                            <% } %>
                                                        </tr>
                                                        <% }) %>
                                                    </tbody>
                                                </table>
                                                <% } %>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Single Tab Content End -->

                                    <!-- Single Tab Content Start -->
                                    <div class="tab-pane fade" id="address-edit" role="tabpanel">
                                        <div class="myaccount-content">
                                            <h3>آدرس های ایجاد شده</h3>

                                            <address>
                                                <p><strong><%- buyer.fullName %></strong></p>
                                               <p><%- buyer.address %></p>
                                                <p>موبایل:<%- buyer.phone %></p>
                                            </address>

                                            <a href="#" class="ht-btn black-btn d-inline-block edit-address-btn"><i class="fa fa-edit"></i>جهت ویرایش آدرس به قسمت جزئیات حساب مراجعه بفرمائید</a>
                                        </div>
                                    </div>
                                    <!-- Single Tab Content End -->

                                    <!-- Single Tab Content Start -->
                                    <div class="tab-pane fade" id="account-info" role="tabpanel">
                                        <div class="myaccount-content">
                                            <h3>جزئیات حساب</h3>

                                            <div class="account-details-form">
                                                <form action="/buyer/updateUserAccount" method="post" id="updateUserAccountSubmit">
                                                    <div class="row">
                                                        <div class="col-12 mb-30">
                                                            <h4>اطلاعات فردی</h4>
                                                        </div>
                                                        <div class="col-lg-6 col-12 mb-30">
                                                            <input id="name" name="name" placeholder="نام " value="<%- user.name %>" type="text">
                                                            <p style="display:none; color: red" id="nameEmpty">این فیلد نباید خالی باشد</p>

                                                        </div>

                                                        <div class="col-lg-6 col-12 mb-30">
                                                            <input id="family" name="family" placeholder="نام خانوادگی"  value="<%- user.family %>" type="text">
                                                            <p style="display:none; color: red" id="familyEmpty">این فیلد نباید خالی باشد</p>

                                                        </div>

                                                        <div class="col-12 mb-30">
                                                            <input id="phone" name="phone"  placeholder="شماره موبایل"  value="<%- user.phone %>" type="number">
                                                            <p style="display:none; color: red" id="phoneEmpty">این فیلد نباید خالی باشد</p>
                                                        </div>

                                                        <div class="col-12 mb-30">
                                                            <h6>تغیر آدرس</h6>
                                                        </div>
                                                        <div class="col-12 mb-30">
                                                            <input name="address" id="address" placeholder="آدرس"  value="<%- user.address %>" type="text">
                                                            <p style="display:none; color: red" id="addressEmpty">این فیلد نباید خالی باشد</p>
                                                        </div>

                                                        

                                                        <div class="col-12 mb-30">
                                                            <h4>تغییر رمز عبور (اگر قصد تغیر ندارید، فیلد ها را بصورت خالی رها کنید)</h4>
                                                        </div>

                                                        <div class="col-12 mb-30">
                                                            <input name="currentPassword" id="currentpwd" placeholder="رمز عبور فعلی" type="password">
                                                            <p style="display:none; color: red" id="currentPasswordmEmpty">این فیلد نباید خالی باشد</p>
                                                            <p style="display:none; color: red" id="currentPasswordmWrong">رمز فعلی شما صحیح نمیباشد</p>
                                                        </div>

                                                        <div class="col-lg-6 col-12 mb-30">
                                                            <input name="newPassword" id="newpwd" placeholder="رمز عبور جدید" type="password">
                                                            <p  style="display:none; color: red" id="newPasswordmEmpty">این فیلد نباید خالی باشد</p>
                                                            <p  style="display:none; color: red" id="newPasswordmLength">رمز نمیتواند کمتر از 8 کاراکتر باشد</p>

                                                        </div>

                                                        <div class="col-lg-6 col-12 mb-30">
                                                            <input name="confirmPassword" id="confirmpwd" placeholder="تایید رمز عبور" type="password">
                                                            <p  style="display:none; color: red" id="confirmEmpty">این فیلد نباید خالی باشد</p>
                                                            <p style="display:none; color: red" id="confirmNotMatch">رمز عبور مطابقت ندارد</p>
                                                        </div>
                                                        <% if (err) { %>
                                                            <p style="color: red ;font-weight: bold" id="confirmNotMatch"><%- err %></p>
                                                            <p style="color: green; font-weight: bold" id="confirmNotMatch"><%- suc %></p>

                                                        <% } %>
                                                        <div class="col-12">
                                                            <button type="button" onclick="checkUserAcount()" class="btn btn-primary btn-hover-secondary">ذخیره تغییرات</button>
                                                        </div>

                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Single Tab Content End -->
                                </div>
                            </div>
                            <!-- My Account Tab Content End -->
                        </div>

                    </div>

                </div>
            </div>
        </div>
        <!--My Account section end-->

        <%- include('./../footer' ) %>


        <!-- Scroll Top Start -->
        <a href="#" class="scroll-top" id="scroll-top">
            <i class="arrow-top fal fa-long-arrow-up"></i>
            <i class="arrow-bottom fal fa-long-arrow-up"></i>
        </a>
        <!-- Scroll Top End -->
    </div>

    <%- include('./../mobileHeader' , {req , card}) %>

    <!-- JS
============================================ -->

    <!-- Vendors JS -->
    <!-- <script src="assets/js/vendor/modernizr-3.6.0.min.js"></script>
<script src="assets/js/vendor/jquery-3.4.1.min.js"></script>
<script src="assets/js/vendor/jquery-migrate-3.1.0.min.js"></script>
<script src="assets/js/vendor/bootstrap.bundle.min.js"></script> -->

    <!-- Plugins JS -->
    <!-- <script src="assets/js/plugins/parallax.min.js"></script>
<script src="assets/js/plugins/jquery.ajaxchimp.min.js"></script> -->

    <!-- Use the minified version files listed below for better performance and remove the files listed above -->
    <script src="assets/js/vendor/vendor.min.js"></script>
    <script src="assets/js/plugins/plugins.min.js"></script>

    <!-- Main Activation JS -->
    <script src="assets/js/main.js"></script>
    <script src="js/userAcount.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

    <!-- ینی یه محصولی حذف شده است -->
    <% if (err != ''){ %>
        <script>
            Swal.fire(
                '<%- err %>',
                'درصورت مشکل با پشتیبانی تماس حاصل فرمائید',
                'error'
            )
        </script>
        <% }%>

        <% if (suc != ''){ %>
            <script>
                Swal.fire(
                    '<%- suc %>',
                    '',
                    'success'
                )
            </script>
            <% }%>
    
    


</body>


</html>